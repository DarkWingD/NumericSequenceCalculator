@model Numeric_Sequence_Calculator.Models.MagicNumber
@{
    ViewBag.Title = "Home Page";
}
<div class="container">
    <h1>Numeric Sequence Calculator</h1>
    <h2>by Daniel Wood</h2>
    <hr />
    <form id="mainform">
        <h3>Enter a number and hit "GO"</h3>
        @Html.TextBoxFor(x => x.Number, new { id = "txtMagicNumber", @class = "form-control centered" })
        @Html.ValidationMessageFor(x => x.Number, "", new { @class = "standardPadding centered" })
        <button id="calculateSequenceBtn" type="submit" class="btn btn-primary centered has-spinner" style="margin-top: 20px;" >
            <span class="spinner">
                <i class="fa fa-refresh fa-spin"></i>
            </span>GO
        </button>
        @*<input type="submit" id="calculateSequenceBtn" value="GO" style="margin-top: 20px;" class="btn btn-primary centered" />*@
    </form>
    <div id="loadingDiv">
        Loading your data now!!!!
    </div>
    <div id="results"></div>
</div>

@section scripts
{
    <script>
        var maxNumber =9999;
        var $loading = $('#loadingDiv').hide();
        $(document)
          .ajaxStart(function () {
              $('#calculateSequenceBtn').toggleClass('active');
          })
          .ajaxStop(function () {
              $('#calculateSequenceBtn').toggleClass('active');
          });
        $(document).ready(function () {
            $(this).validate();
            $('#mainform').submit(function (event) {
                if ($("form").valid()) {
                    if ($(txtMagicNumber).val() > maxNumber) {
                        if (!confirm('Your number is larger than ' + maxNumber + ', this may take a little while to calculate, and may cause an error, click Yes to try anyway or No to enter a different number')) {
                            return;
                        }
                    }
                    $('#results').html('');
                    //$('#results').fadeOut('slow');
                    var json = JSON.stringify({ MagicNumber: $(txtMagicNumber).val() });
                    var url = '@Url.Action("CalculateSequence")';
                    $.ajax({
                        type: "POST",
                        url: url,
                        data: json,
                        contentType: "application/json"
                    }).success(function (data) {
                        $('#results').html(data);
                        //$('#results').fadeIn('slow');
                    });
                }
                $('html, body').animate({ scrollTop: $(document).height() }, 'slow');
                event.preventDefault();
            });
        });
    </script>
}